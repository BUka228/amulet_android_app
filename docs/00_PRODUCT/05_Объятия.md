# Фича «Объятия» (Social Hugs)

## 1. Цели фичи
- Создать тёплый, тактильный канал связи между людьми через амулеты, который ощущается как «объятие», а не как ещё одно уведомление.
- Дать пользователям простой, быстрый и безопасный способ выражать эмоции (забота, поддержка, радость, скучание) на расстоянии.
- Связать социальные «объятия» с экосистемой паттернов и практик (конструктор анимаций, статистика, интеграции).
- Обеспечить надёжную, приватную и защищённую передачу «объятий» между парой устройств с анти‑спам ограничениями.

## 2. Основные сущности
- **Пара (Pair)**
  - Два пользователя, взаимно подтвердившие связь для «объятий».
  - Атрибуты: `pairId`, `userAId`, `userBId`, дата создания.
  - Метаданные: название связи («Партнёр», «Родитель», «Друг»), аватар/эмодзи пары.

- **Объятие (Hug)**
  - Событие передачи эмоции от одного пользователя к другому через амулеты и приложение.
  - Атрибуты: `hugId`, отправитель, получатель, `patternId` (паттерн света/вибрации), тип/эмоция, время отправки/доставки/открытия, статус (отправлено/доставлено/прочитано/просрочено).
  - Опционально: связанный пользовательский паттерн, комментарий/короткое текстовое сообщение.

- **Эмоциональная палитра (EmotionPalette)**
  - Коллекция преднастроенных эмоций пары: цвет + паттерн вибрации/света + название («Скучаю», «Поддержка», «Радость»).
  - Доступ к редактированию: совместно (оба могут менять) или владелец пары.

- **Быстрый ответ (QuickReply)**
  - Преднастроенное «объятие‑ответ», отправляемое жестом на амулете (например, двойной тап).
  - Атрибуты: ссылка на эмоцию/паттерн, поведение при получении (мгновенный показ без открытия приложения).

- **Секретные коды (SecretCodes)**
  - Персональные «языки» пары: уникальные последовательности диодов и вибраций, несущие приватный смысл.
  - Хранятся как пользовательские паттерны, могут быть связаны с конкретными действиями («Я дома», «Я думаю о тебе»).

- **История «объятий» (HugHistory)**
  - Лента событий отправленных и полученных «объятий» с фильтрами и реакциями.
  - Используется для аналитики (частота, время суток) и статистики приложения.

- **Настройки и ограничения (HugSettings)**
  - Переключатели: «Получать объятия от пары», «Быстрые объятия только днём», «Тихие часы», DND.
  - Лимиты: защита от спама (rate limiting), авто‑сворачивание повторных «объятий» в один блок.

## 3. Высокоуровневый UX-флоу
- **Онбординг фичи «Объятия»**
  - Пользователь узнаёт о функции из онбординга/дешборда («Соедините свои амулеты с близким человеком»).
  - CTA ведёт в мастер создания пары: выбор партнёра, отправка приглашения, подтверждение.

- **Создание и подтверждение пары**
  - Пользователь A отправляет приглашение по ссылке / QR / шерингу.
  - Пользователь B открывает ссылку → deep link в приложение → экран с подтверждением.
  - После взаимного согласия создаётся сущность Pair, включаются базовые паттерны эмоций.

- **Настройка эмоций и секретных кодов**
  - Пара выбирает 3–7 базовых эмоций («Скучаю», «Поддержка», «Рад за тебя» и т.п.).
  - Для каждой эмоции настраивается цвет, паттерн, интенсивность, длительность.
  - В отдельном режиме «Секретные коды» пара создаёт собственные комбинации диодов/вибраций.

- **Отправка «объятия»**
  - Из приложения: пользователь открывает экран «Объятия», выбирает эмоцию из палитры или историю, при желании добавляет короткий текст.
  - Из амулета: жест (двойной тап/долгое нажатие) отправляет преднастроенный QuickReply партнёру.
  - Бэкенд доставляет событие на устройство получателя, приложение синхронизирует с амулетом.

- **Получение и ответ**
  - Амулет получателя загорается и вибрирует по паттерну эмоции, даже если телефон заблокирован (с учётом настроек DND и тихих часов).
  - На телефоне приходит нативное уведомление / in-app баннер с кратким описанием эмоции.
  - Получатель может: отметить реакцией («сердце», «обнял в ответ»), отправить быстрый ответ жестом или развернуть полный экран с деталями.

- **История и аналитика**
  - В отдельной вкладке показывается история «объятий» с возможностью фильтрации: «Отправленные», «Полученные», по эмоциям.
  - Показ лёгкой статистики: сколько «объятий» за неделю/месяц, в какое время суток они чаще приходят.

- **Безопасность и приватность**
  - Все «объятия» шифруются, доступ к истории есть только у участвующих пользователей.
  - Пользователь может временно приостановить получение «объятий» или разорвать пару.

## 4. Структура экранов

### 4.1. Экран «Объятия» (главный экран фичи)
- **Цели экрана**
  - Дать быстрый доступ к отправке «объятия» партнёру(ам).
  - Показать последние события и создать ощущение «живой связи».

- **Основные элементы**
  - Верхний AppBar:
    - Заголовок «Объятия».
    - Иконки перехода в «Историю» и «Настройки».
  - Блок «Партнёр» / «Пары»:
    - Карточка(и) с аватаром пары и быстрым CTA «Отправить».
  - Блок «Эмоции»:
    - Горизонтальный список/чипы с основными эмоциями: цвет, иконка, подпись.
    - Долгое нажатие по эмоции открывает её редактирование.
  - Блок «Быстрый ответ»:
    - Краткое описание, какой паттерн сейчас привязан к жесту на амулете.
    - CTA «Настроить быстрый ответ».
  - Блок «Последние объятия»:
    - Несколько последних событий с мини‑визуализацией паттерна, временем и направлением (от кого/кому).

- **Интеракции**
  - Тап по эмоции сразу отправляет «объятие» с подтверждением/анимацией.
  - Свайп по карточке партнёра может открывать быстрые действия: «Поставить на паузу», «Отключить ночью».

### 4.2. Экран «Создание/редактирование пары»
- **Цели**
  - Простое создание связи без сложных настроек.
  - Понятное подтверждение и контроль, что связь двусторонняя.

- **Основные элементы**
  - Шаг 1: объяснение, что такое «объятия» и как работает пара.
  - Шаг 2: генерация и шаринг ссылки/QR.
  - Шаг 3: ожидание подтверждения (статус «ожидание», возможность отменить приглашение).
  - Экран подтверждения для второго пользователя: аватар/имя инициатора, CTA «Принять»/«Отклонить».

### 4.3. Экран «Настройка эмоций и секретных кодов»
- **Палитра эмоций**
  - Список/сет эмоций с цветом, названием и мини‑иконкой паттерна.
  - Кнопка «Добавить эмоцию».

- **Редактор эмоции**
  - Поле названия эмоции («Я скучаю», «Горжусь тобой»).
  - Выбор базового цвета и интенсивности.
  - Привязка паттерна из конструктора анимаций или выбор из пресетов.
  - Превью на виртуальном амулете и (по запросу) на реальном устройстве.

- **Секретные коды**
  - Отдельный раздел с пометкой о приватности.
  - Список кодов с названиями и мини‑превью последовательности диодов.
  - Экран редактирования кода: визуальный редактор последовательности зажигания диодов и вибраций (переиспользование UI из конструктора).

### 4.4. Экран «История объятий»
- **Элементы**
  - Фильтры по направлению (отправленные/полученные), эмоциям, периоду.
  - Лента событий: карточка с аватаром отправителя, эмоцией, временем, текстовым комментарием (если есть).
  - Маленькие бейджи статуса доставки (отправлено/доставлено/прочитано).

- **Интеракции**
  - Тап по событию открывает детали (паттерн, текст, опция «Ответить таким же», «Создать на основе»).
  - Возможность «запинить» важные «объятия» (например, годовщина) вверху списка.

### 4.5. Экран «Настройки объятий»
- **Блоки**
  - Тихие часы: выбор интервала, когда амулет не будет вибрировать/светиться от «объятий».
  - Режим DND: полностью отключить реакции амулета, оставить только пуши или наоборот.
  - Anti‑spam: лимиты по количеству «объятий» в час/день, с мягкими подсказками.
  - Управление парами: список пар, возможность временно отключить/разорвать связь.

## 5. Enterprise‑аспекты UI/UX и продуктовые требования
- Чёткое объяснение пользователю, что «объятия» не являются мессенджером и не заменяют текст/голос.
- Прозрачная модель приватности: кто видит историю, как можно удалить свои данные.
- Ограничения на частоту «объятий» (особенно в B2B/семейных сценариях) с целью предотвратить абьюз и спам.
- Возможность расширения до мультипарных сценариев (несколько пар/группы) без потери простоты базового UX.
- Локализуемые тексты эмоций и объяснений для разных культурных контекстов.

## 6. Интеграция с амулетом и другими фичами
- Каждая эмоция связана с конкретным паттерном амулета (цвет, анимация, вибрация), переиспользуемым из конструктора анимаций.
- При отсутствии подключения к амулету «объятие» всё равно сохраняется и воспроизводится при следующем подключении (с отметкой об отложенной доставке).
- Интеграция с практиками:
  - Возможность отправить «объятие» после завершения практики («Поделиться состоянием спокойствия»).
  - Специальные паттерны для поддерживающих «объятий» в моменты стресса (триггеруемые через Control Center/IFTTT).
- Интеграция со статистикой:
  - Учёт частоты и направленности «объятий» в общей аналитике (без раскрытия содержимого паттернов).
  - Мягкая геймификация (бейджи за регулярные «объятия», годовщины связи и т.п.).
